// Ficheiro: prisma/schema.prisma
datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// Enum para os níveis de permissão
enum PermissaoNivel {
  master
  empresa
  setor
}

// Tabela de Entidades 

model Entity {
  id        String    @id @default(cuid())
  nome      String    @unique @db.VarChar(100)
  parentId  String?   @map("parent_id") // ID da entidade-mãe (null se for matriz)
  
  // Relacionamentos
  users     User[]
  campaigns Campaign[]
  
  @@map("entidades")
}

// Tabela de Usuários
model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String    @db.VarChar(255)
  nome      String    @db.VarChar(100)
  
  permissaoNivel PermissaoNivel @map("permissao_nivel")

  entidadeRestritaId String?   @map("entidade_restrita_id")
  entidadeRestrita   Entity? @relation(fields: [entidadeRestritaId], references: [id])
  
  @@map("usuarios")
}

// Tabela de Campanhas 
// Esta tabela salva o pacote de dados do upload.
model Campaign {
  id          String    @id @default(cuid())
  // Ex: "Cesta Básica - Novembro/2025"
  nomeCampanha String  @map("nome_campanha") @db.VarChar(150)
  createdAt   DateTime  @default(now()) @map("criado_em")
  
  entidadeId  String    @map("entidade_id")
  entidade    Entity @relation(fields: [entidadeId], references: [id])
  
  dadosPlanilha Json    @map("dados_planilha") 

  @@map("campanhas")
}

model CampaignNatal {
  id            String   @id @default(uuid())
  nomeCampanha  String
  entidadeId    String
  dadosPlanilha Json
  createdAt     DateTime @default(now())
}